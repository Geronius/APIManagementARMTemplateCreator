{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "apimServiceName": {
      "type": "string",
      "defaultValue": "ibizmalo"
    },
    "apimServiceName_sku_name": {
      "type": "string",
      "defaultValue": "Developer"
    },
    "apimServiceName_sku_capacity": {
      "type": "string",
      "defaultValue": "1"
    },
    "apimServiceName_location": {
      "type": "string",
      "defaultValue": "West Europe"
    },
    "apimServiceName_publisherEmail": {
      "type": "string",
      "defaultValue": "mattias.logdberg@ibiz-solutions.se"
    },
    "apimServiceName_publisherName": {
      "type": "string",
      "defaultValue": "ibiz"
    },
    "apimServiceName_notificationSenderEmail": {
      "type": "string",
      "defaultValue": "apimgmt-noreply@mail.windowsazure.com"
    },
    "apimServiceName_virtualNetworkType": {
      "type": "string",
      "defaultValue": "External"
    },
    "apimServiceName_virtualNetwork_subnetname": {
      "type": "string",
      "defaultValue": ""
    },
    "apimServiceName_virtualNetwork_subnetResourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.Network/virtualNetworks/Network/subnets/default"
    },
    "apimServiceName_virtualNetwork_vnetid": {
      "type": "string",
      "defaultValue": "00000000-0000-0000-0000-000000000000"
    },
    "identityProvider_Microsoft_name": {
      "type": "string",
      "defaultValue": "Microsoft"
    },
    "identityProvider_Microsoft_clientId": {
      "type": "string",
      "defaultValue": "08de6f9f-6ac8-4b4d-ab31-d2234a3e5557"
    },
    "identityProvider_Microsoft_clientSecret": {
      "type": "securestring",
      "defaultValue": ""
    },
    "apimServiceName_applicationInsights": {
      "type": "string",
      "defaultValue": "appInsights"
    },
    "logger_azuremonitor_name": {
      "type": "string",
      "defaultValue": "azuremonitor"
    },
    "logger_bpst-apim-l-6a12e_name": {
      "type": "string",
      "defaultValue": "bpst-apim-l-6a12e"
    },
    "logger_bpst-apim-l-6a12e_connectionString": {
      "type": "securestring",
      "defaultValue": ""
    },
    "logger_bpst-apim-l-6a12e_credentialName": {
      "type": "string",
      "defaultValue": "bpst-apim-eh-234ad"
    },
    "diagnostic_appInsights_name": {
      "type": "string",
      "defaultValue": "appInsights"
    },
    "diagnostic_appInsights_alwaysLog": {
      "type": "string",
      "defaultValue": "allErrors"
    },
    "diagnostic_appInsights_samplingPercentage": {
      "type": "string",
      "defaultValue": "100"
    },
    "diagnostic_appInsights_enableHttpCorrelationHeaders": {
      "type": "bool",
      "defaultValue": true
    },
    "diagnostic_azuremonitor_name": {
      "type": "string",
      "defaultValue": "azuremonitor"
    },
    "diagnostic_azuremonitor_alwaysLog": {
      "type": "string",
      "defaultValue": ""
    },
    "diagnostic_azuremonitor_samplingPercentage": {
      "type": "string",
      "defaultValue": "100"
    },
    "api_tfs_name": {
      "type": "string",
      "defaultValue": "tfs"
    },
    "tfs_apiRevision": {
      "type": "string",
      "defaultValue": "1"
    },
    "tfs_serviceUrl": {
      "type": "string",
      "defaultValue": "http://ibizmalotest-backend.azure-api.net/tfsBackend"
    },
    "tfs_isCurrent": {
      "type": "bool",
      "defaultValue": true
    },
    "openidConnectProvider_myOpenIdProvider_name": {
      "type": "string",
      "defaultValue": "myOpenIdProvider"
    },
    "openidConnectProvider_myOpenIdProvider_displayname": {
      "type": "string",
      "defaultValue": "My OpenId Provider"
    },
    "openidConnectProvider_myOpenIdProvider_metadataEndpoint": {
      "type": "string",
      "defaultValue": "https://login.microsoftonline.com/ibiz.emea.microsoftonline.com/.well-known/openid-configuration"
    },
    "openidConnectProvider_myOpenIdProvider_clientId": {
      "type": "string",
      "defaultValue": "a979b408-e0e3-492d-bef4-84756d0adf92"
    },
    "openidConnectProvider_myOpenIdProvider_clientSecret": {
      "type": "securestring",
      "defaultValue": ""
    },
    "myfunctions_resourceGroup": {
      "type": "string",
      "defaultValue": "PreDemoTest"
    },
    "myfunctions_siteName": {
      "type": "string",
      "defaultValue": "myfunctions"
    },
    "certificate_MyCertificate_name": {
      "type": "string",
      "defaultValue": "MyCertificate"
    },
    "certificate_MyCertificate_data": {
      "type": "securestring",
      "defaultValue": ""
    },
    "certificate_MyCertificate_password": {
      "type": "securestring",
      "defaultValue": ""
    },
    "api_tfs_backendurl": {
      "type": "string",
      "defaultValue": "https://api.apis.guru/v2/"
    },
    "apimServiceName2": {
      "type": "string",
      "defaultValue": "common-apim-itest"
    },
    "api_echo-api_name": {
      "type": "string",
      "defaultValue": "echo-api"
    },
    "apimServiceName3": {
      "type": "string",
      "defaultValue": "common-apim-itest"
    },
    "product_unlimited_name": {
      "type": "string",
      "defaultValue": "unlimited"
    },
    "group_office-services_name": {
      "type": "string",
      "defaultValue": "office-services"
    },
    "environment_value": {
      "type": "string",
      "defaultValue": "itest"
    }
  },
  "variables": {
    "virtualNetworkConfiguration": {
      "subnetResourceId": "[if(empty(parameters('apimServiceName_virtualNetwork_subnetResourceId')), json('null'), parameters('apimServiceName_virtualNetwork_subnetResourceId'))]",
      "vnetid": "[if(empty(parameters('apimServiceName_virtualNetwork_vnetid')), json('null'), parameters('apimServiceName_virtualNetwork_vnetid'))]",
      "subnetname": "[if(equals(parameters('apimServiceName_virtualNetwork_subnetname'), ''), json('null'), parameters('apimServiceName_virtualNetwork_subnetname'))]"
    }
  },
  "resources": [
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/Ibizmalo",
      "type": "Microsoft.ApiManagement/service",
      "name": "[parameters('apimServiceName')]",
      "apiVersion": "2017-03-01",
      "properties": {
        "publisherEmail": "[parameters('apimServiceName_publisherEmail')]",
        "publisherName": "[parameters('apimServiceName_publisherName')]",
        "notificationSenderEmail": "[parameters('apimServiceName_notificationSenderEmail')]",
        "hostnameConfigurations": [],
        "additionalLocations": null,
        "customProperties": {
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30": "false",
          "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168": "false"
        },
        "virtualNetworkType": "[parameters('apimServiceName_virtualNetworkType')]",
        "virtualNetworkConfiguration": "[if(not(equals(parameters('apimServiceName_virtualNetworkType'), 'None')), variables('virtualNetworkConfiguration'), json('null'))]"
      },
      "resources": [
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/policies/policy",
          "type": "Microsoft.ApiManagement/service/policies",
          "name": "[concat(parameters('apimServiceName'), '/', 'policy')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "policyContent": "<!--\r\n    IMPORTANT:\r\n    - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.\r\n    - Only the <forward-request> policy element can appear within the <backend> section element.\r\n    - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.\r\n    - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.\r\n    - To add a policy position the cursor at the desired insertion point and click on the round button associated with the policy.\r\n    - To remove a policy, delete the corresponding policy statement from the policy document.\r\n    - Policies are applied in the order of their appearance, from the top down.\r\n-->\r\n<policies>\r\n  <inbound>\r\n    <cross-domain>\r\n      <cross-domain-policy>\r\n        <allow-http-request-headers-from domain=\"*\" headers=\"*\" />\r\n      </cross-domain-policy>\r\n    </cross-domain>\r\n      <choose>\r\n      <when condition=\"@(&quot;{{environment}}&quot; == &quot;atest&quot;)\">\r\n        <mock-response status-code=\"200\" content-type=\"application/json\" />\r\n      </when>\r\n    </choose>\r\n  </inbound>\r\n  <backend>\r\n    <forward-request />\r\n  </backend>\r\n  <outbound />\r\n  <on-error />\r\n</policies>"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/identityProviders/Microsoft",
          "type": "Microsoft.ApiManagement/service/identityProviders",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('identityProvider_Microsoft_name'))]",
          "apiVersion": "2017-03-01",
          "properties": {
            "clientId": "[parameters('identityProvider_Microsoft_clientId')]",
            "clientSecret": "[parameters('identityProvider_Microsoft_clientSecret')]",
            "type": "microsoft"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/loggers/appInsights",
          "type": "Microsoft.Insights/components",
          "name": "[parameters('apimServiceName_applicationInsights')]",
          "apiVersion": "2015-05-01",
          "properties": {
            "Application_Type": "other"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
          ],
          "location": "[parameters('apimServiceName_location')]",
          "kind": "other"
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/loggers/appInsights",
          "type": "Microsoft.ApiManagement/service/loggers",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('apimServiceName_applicationInsights'))]",
          "apiVersion": "2017-03-01",
          "properties": {
            "loggerType": "applicationInsights",
            "description": "Application insights logger",
            "credentials": {
              "instrumentationKey": "[reference(resourceId('Microsoft.Insights/components', parameters('apimServiceName_applicationInsights')), '2014-04-01').InstrumentationKey]"
            },
            "isBuffered": true
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.Insights/components',parameters('apimServiceName_applicationInsights'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/loggers/azuremonitor",
          "type": "Microsoft.ApiManagement/service/loggers",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('logger_azuremonitor_name'))]",
          "apiVersion": "2017-03-01",
          "properties": {
            "loggerType": "azureMonitor",
            "description": null,
            "isBuffered": true,
            "resourceId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/loggers/bpst-apim-l-6a12e",
          "type": "Microsoft.ApiManagement/service/loggers",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('logger_bpst-apim-l-6a12e_name'))]",
          "apiVersion": "2017-03-01",
          "properties": {
            "loggerType": "azureEventHub",
            "description": "BPST Template Logger",
            "credentials": {
              "connectionString": "[parameters('logger_bpst-apim-l-6a12e_connectionString')]",
              "name": "[parameters('logger_bpst-apim-l-6a12e_credentialName')]"
            },
            "isBuffered": true,
            "resourceId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/diagnostics/appInsights",
          "type": "Microsoft.ApiManagement/service/diagnostics",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('diagnostic_appInsights_name'))]",
          "apiVersion": "2024-05-01",
          "properties": {
            "alwaysLog": "[parameters('diagnostic_appInsights_alwaysLog')]",
            "enableHttpCorrelationHeaders": "[parameters('diagnostic_appInsights_enableHttpCorrelationHeaders')]",
            "loggerId": "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('apimServiceName'), parameters('apimServiceName_applicationInsights'))]",
            "sampling": {
              "samplingType": "fixed",
              "percentage": "[parameters('diagnostic_appInsights_samplingPercentage')]"
            },
            "frontend": {
              "request": {
                "headers": [],
                "body": {
                  "bytes": 0
                }
              },
              "response": {
                "headers": [],
                "body": {
                  "bytes": 0
                }
              }
            },
            "backend": {
              "request": {
                "headers": [],
                "body": {
                  "bytes": 0
                }
              },
              "response": {
                "headers": [],
                "body": {
                  "bytes": 0
                }
              }
            }
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('apimServiceName'), parameters('apimServiceName_applicationInsights'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/diagnostics/azuremonitor",
          "type": "Microsoft.ApiManagement/service/diagnostics",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('diagnostic_azuremonitor_name'))]",
          "apiVersion": "2024-05-01",
          "properties": {
            "alwaysLog": "[parameters('diagnostic_azuremonitor_alwaysLog')]",
            "loggerId": "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('apimServiceName'), parameters('logger_azuremonitor_name'))]",
            "sampling": {
              "samplingType": "fixed",
              "percentage": "[parameters('diagnostic_azuremonitor_samplingPercentage')]"
            },
            "frontend": null,
            "backend": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('apimServiceName'), parameters('logger_azuremonitor_name'))]"
          ]
        }
      ],
      "dependsOn": [],
      "sku": {
        "name": "[parameters('apimServiceName_sku_name')]",
        "capacity": "[parameters('apimServiceName_sku_capacity')]"
      },
      "location": "[parameters('apimServiceName_location')]",
      "identity": {
        "type": "SystemAssigned"
      },
      "tags": {},
      "scale": null
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/apis/tfs",
      "type": "Microsoft.ApiManagement/service/apis",
      "name": "[concat(parameters('apimServiceName'), '/' ,parameters('api_tfs_name'))]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "TFS",
        "apiRevision": "[parameters('tfs_apiRevision')]",
        "description": " A nice warm laptop for me to sit on find empty spot in cupboard and sleep all day, i like fish and have my breakfast spaghetti yarn spill litter box, scratch at owner, destroy all furniture, especially couch i could pee on this if i had the energy. Hack up furballs claw your carpet in places everyone can see - why hide my amazing artistic clawing skills?",
        "serviceUrl": "[parameters('tfs_serviceUrl')]",
        "path": "tfs",
        "protocols": [
          "https"
        ],
        "authenticationSettings": {
          "oAuth2": null,
          "openid": {
            "openidProviderId": "myOpenIdProvider",
            "bearerTokenSendingMethods": null
          }
        },
        "subscriptionKeyParameterNames": {
          "header": "Ocp-Apim-Subscription-Key",
          "query": "subscription-key"
        },
        "isCurrent": "[parameters('tfs_isCurrent')]"
      },
      "resources": [
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/apis/tfs/operations/Customer_GetCustomerInfo",
          "type": "Microsoft.ApiManagement/service/apis/operations",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('api_tfs_name'), '/', 'Customer_GetCustomerInfo')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "Customer_GetCustomerInfo",
            "method": "POST",
            "urlTemplate": "/api/Customer",
            "templateParameters": [],
            "description": null,
            "request": {
              "queryParameters": [],
              "headers": [],
              "representations": [
                {
                  "contentType": "application/json",
                  "sample": "{\r\n  \"NationalIdentityNumber\": \"194008045116\"\r\n}",
                  "schemaId": "5b7572981142a50298c7f4a6",
                  "typeName": "GetCustomerRequest"
                },
                {
                  "contentType": "text/json",
                  "sample": "{\r\n  \"NationalIdentityNumber\": \"194008045116\"\r\n}",
                  "schemaId": "5b7572981142a50298c7f4a6",
                  "typeName": "GetCustomerRequest"
                },
                {
                  "contentType": "application/xml",
                  "sample": "{\r\n  \"NationalIdentityNumber\": \"194008045116\"\r\n}",
                  "schemaId": "5b7572981142a50298c7f4a6",
                  "typeName": "GetCustomerRequest"
                },
                {
                  "contentType": "text/xml",
                  "sample": "{\r\n  \"NationalIdentityNumber\": \"194008045116\"\r\n}",
                  "schemaId": "5b7572981142a50298c7f4a6",
                  "typeName": "GetCustomerRequest"
                },
                {
                  "contentType": "application/x-www-form-urlencoded"
                }
              ]
            },
            "responses": [
              {
                "statusCode": 200,
                "description": "Information was found",
                "representations": [
                  {
                    "contentType": "application/json",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "Customer"
                  },
                  {
                    "contentType": "text/json",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "Customer"
                  },
                  {
                    "contentType": "application/xml",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "Customer"
                  },
                  {
                    "contentType": "text/xml",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "Customer"
                  }
                ],
                "headers": []
              },
              {
                "statusCode": 400,
                "description": "There is an error with the request",
                "representations": [
                  {
                    "contentType": "application/json",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "ErrorResponse"
                  },
                  {
                    "contentType": "text/json",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "ErrorResponse"
                  },
                  {
                    "contentType": "application/xml",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "ErrorResponse"
                  },
                  {
                    "contentType": "text/xml",
                    "schemaId": "5b7572981142a50298c7f4a6",
                    "typeName": "ErrorResponse"
                  }
                ],
                "headers": []
              },
              {
                "statusCode": 401,
                "description": "Incorrect API-key",
                "representations": [
                  {
                    "contentType": "application/json"
                  },
                  {
                    "contentType": "text/json"
                  },
                  {
                    "contentType": "application/xml"
                  },
                  {
                    "contentType": "text/xml"
                  }
                ],
                "headers": []
              }
            ],
            "policies": null
          },
          "resources": [
            {
              "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/apis/tfs/operations/Customer_GetCustomerInfo/policies/policy",
              "type": "Microsoft.ApiManagement/service/apis/operations/policies",
              "name": "[concat(parameters('apimServiceName'), '/', parameters('api_tfs_name'), '/', 'Customer_GetCustomerInfo', '/', 'policy')]",
              "apiVersion": "2017-03-01",
              "properties": {
                "policyContent": "<!--\r\n    IMPORTANT:\r\n    - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.\r\n    - Only the <forward-request> policy element can appear within the <backend> section element.\r\n    - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.\r\n    - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.\r\n    - To add a policy position the cursor at the desired insertion point and click on the round button associated with the policy.\r\n    - To remove a policy, delete the corresponding policy statement from the policy document.\r\n    - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.\r\n    - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.\r\n    - Policies are applied in the order of their appearance, from the top down.\r\n-->\r\n<policies>\r\n  <inbound>\r\n    <base />\r\n    <set-backend-service id=\"apim-generated-policy\" backend-id=\"myfunctions\" />\r\n  </inbound>\r\n  <backend>\r\n    <base />\r\n  </backend>\r\n  <outbound>\r\n    <base />\r\n  </outbound>\r\n  <on-error>\r\n    <base />\r\n  </on-error>\r\n</policies>"
              },
              "resources": [],
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apimServiceName') , parameters('api_tfs_name'))]",
                "[resourceId('Microsoft.ApiManagement/service/apis/operations', parameters('apimServiceName'), parameters('api_tfs_name'), 'Customer_GetCustomerInfo')]"
              ]
            }
          ],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.ApiManagement/service/apis/schemas', parameters('apimServiceName'),parameters('api_tfs_name'),'5b7572981142a50298c7f4a6')]",
            "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apimServiceName'),parameters('api_tfs_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/032501fb-82d6-4618-9fda-0a32a3a63c08/resourceGroups/common-apim-itest/providers/Microsoft.ApiManagement/service/common-apim-itest/apis/echo-api/policies/policy",
          "type": "Microsoft.ApiManagement/service/apis/policies",
          "name": "[concat(parameters('apimServiceName3'), '/', parameters('api_echo-api_name'), '/', 'policy')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "policyContent": "<!--\r\n    IMPORTANT:\r\n    - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.\r\n    - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.\r\n    - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.\r\n    - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.\r\n    - To remove a policy, delete the corresponding policy statement from the policy document.\r\n    - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.\r\n    - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.\r\n    - Policies are applied in the order of their appearance, from the top down.\r\n    - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.\r\n-->\r\n<policies>\r\n  <inbound>\r\n    <base />\r\n    <authentication-certificate thumbprint=\"CCA33558DEC546C6A3E52F90DE7B0884\" />\r\n    <set-backend-service base-url=\"{{api_tfs_backendurl}}\" />\r\n  </inbound>\r\n  <backend>\r\n    <base />\r\n  </backend>\r\n  <outbound>\r\n    <base />\r\n  </outbound>\r\n  <on-error>\r\n    <base />\r\n  </on-error>\r\n</policies>"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apimServiceName') , parameters('api_echo-api_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/apis/tfs/schemas/5b7572981142a50298c7f4a6",
          "type": "Microsoft.ApiManagement/service/apis/schemas",
          "name": "[concat(parameters('apimServiceName'),'/',parameters('api_tfs_name'),'/','5b7572981142a50298c7f4a6')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "contentType": "application/vnd.ms-azure-apim.swagger.definitions+json",
            "document": {
              "definitions": {
                "GetCustomerRequest": {
                  "required": [
                    "NationalIdentityNumber"
                  ],
                  "type": "object",
                  "properties": {
                    "NationalIdentityNumber": {
                      "maxLength": 12,
                      "minLength": 12,
                      "pattern": "^\\d{12}$",
                      "type": "string"
                    }
                  },
                  "example": {
                    "NationalIdentityNumber": "196512141234"
                  }
                }
              }
            }
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
            "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apimServiceName'),parameters('api_tfs_name'))]"
          ]
        }
      ],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
        "[resourceId('Microsoft.ApiManagement/service/backends', parameters('apimServiceName'), 'myfunctions')]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/openidConnectProviders/myOpenIdProvider",
      "type": "Microsoft.ApiManagement/service/openidConnectProviders",
      "name": "[concat(parameters('apimServiceName'),'/',parameters('openidConnectProvider_myOpenIdProvider_name'))]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "[parameters('openidConnectProvider_myOpenIdProvider_displayname')]",
        "description": null,
        "metadataEndpoint": "[parameters('openidConnectProvider_myOpenIdProvider_metadataEndpoint')]",
        "clientId": "[parameters('openidConnectProvider_myOpenIdProvider_clientId')]",
        "clientSecret": "[parameters('openidConnectProvider_myOpenIdProvider_clientSecret')]"
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/backends/myfunctions",
      "type": "Microsoft.ApiManagement/service/backends",
      "name": "[concat(parameters('apimServiceName'), '/' ,'myfunctions')]",
      "apiVersion": "2017-03-01",
      "properties": {
        "title": null,
        "description": "[parameters('myfunctions_siteName')]",
        "url": "[concat('https://',toLower(parameters('myfunctions_siteName')),'.azurewebsites.net/api')]",
        "protocol": "http",
        "resourceId": "[concat('https://management.azure.com/','subscriptions/',subscription().subscriptionId,'/resourceGroups/',parameters('myfunctions_resourceGroup'),'/providers/Microsoft.Web/sites/',parameters('myfunctions_siteName'))]",
        "credentials": {
          "query": {
            "code": [
              "{{myfunctions-key}}"
            ]
          }
        }
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service/properties', parameters('apimServiceName'),'myfunctions-key')]",
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/certificates/MyCertificate",
      "type": "Microsoft.ApiManagement/service/certificates",
      "name": "[concat(parameters('apimServiceName'),'/',parameters('certificate_MyCertificate_name'))]",
      "apiVersion": "2017-03-01",
      "properties": {
        "data": "[parameters('certificate_MyCertificate_data')]",
        "password": "[parameters('certificate_MyCertificate_password')]"
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/032501fb-82d6-4618-9fda-0a32a3a63c08/resourceGroups/common-apim-itest/providers/Microsoft.ApiManagement/service/common-apim-itest/properties/api_tfs_backendurl",
      "type": "Microsoft.ApiManagement/service/properties",
      "name": "[concat(parameters('apimServiceName2'),'/','api_tfs_backendurl')]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "api_tfs_backendurl",
        "value": "[parameters('api_tfs_backendurl')]",
        "secret": false
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited",
      "type": "Microsoft.ApiManagement/service/products",
      "name": "[concat(parameters('apimServiceName'), '/' ,parameters('product_unlimited_name'))]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "Unlimited",
        "description": "Subscribers have completely unlimited access to the API. Administrator approval is required.",
        "terms": null,
        "subscriptionRequired": true,
        "approvalRequired": true,
        "subscriptionsLimit": 1,
        "state": "published"
      },
      "resources": [
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/apis/tfs",
          "type": "Microsoft.ApiManagement/service/products/apis",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', parameters('api_tfs_name'))]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "TFS",
            "apiRevision": "1",
            "description": " A nice warm laptop for me to sit on find empty spot in cupboard and sleep all day, i like fish and have my breakfast spaghetti yarn spill litter box, scratch at owner, destroy all furniture, especially couch i could pee on this if i had the energy. Hack up furballs claw your carpet in places everyone can see - why hide my amazing artistic clawing skills?",
            "serviceUrl": "https://ibizmalotest.azure-api.net/tfs",
            "path": "tfs",
            "protocols": [
              "https"
            ],
            "authenticationSettings": null,
            "subscriptionKeyParameterNames": null,
            "isCurrent": true,
            "apiVersion": "v1",
            "apiVersionSetId": "[resourceId('Microsoft.ApiManagement/service/apiVersionSets', parameters('apimServiceName'), '5b1fb4607e5c66b5cb2fe2e8')]"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/groups/administrators",
          "type": "Microsoft.ApiManagement/service/products/groups",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', 'administrators')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "Administrators",
            "description": "Administrators is a built-in group. Its membership is managed by the system. Microsoft Azure subscription administrators fall into this group.",
            "builtIn": true,
            "type": "system",
            "externalId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/groups/developers",
          "type": "Microsoft.ApiManagement/service/products/groups",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', 'developers')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "Developers",
            "description": "Developers is a built-in group. Its membership is managed by the system. Signed-in users fall into this group.",
            "builtIn": true,
            "type": "system",
            "externalId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/groups/guests",
          "type": "Microsoft.ApiManagement/service/products/groups",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', 'guests')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "Guests",
            "description": "Guests is a built-in group. Its membership is managed by the system. Unauthenticated users visiting the developer portal fall into this group.",
            "builtIn": true,
            "type": "system",
            "externalId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/groups/office-services",
          "type": "Microsoft.ApiManagement/service/products/groups",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', 'office-services')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "displayName": "Office Services",
            "description": null,
            "builtIn": false,
            "type": "custom",
            "externalId": null
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        },
        {
          "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/products/unlimited/policies/policy",
          "type": "Microsoft.ApiManagement/service/products/policies",
          "name": "[concat(parameters('apimServiceName'), '/', parameters('product_unlimited_name'), '/', 'policy')]",
          "apiVersion": "2017-03-01",
          "properties": {
            "policyContent": "<!--\r\n            IMPORTANT:\r\n            - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.\r\n            - Only the <forward-request> policy element can appear within the <backend> section element.\r\n            - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.\r\n            - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.\r\n            - To add a policy position the cursor at the desired insertion point and click on the round button associated with the policy.\r\n            - To remove a policy, delete the corresponding policy statement from the policy document.\r\n            - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.\r\n            - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.\r\n            - Policies are applied in the order of their appearance, from the top down.\r\n        -->\r\n<policies>\r\n  <inbound>\r\n    <rate-limit calls=\"5\" renewal-period=\"60\" />\r\n    <quota calls=\"100\" renewal-period=\"604800\" />\r\n    <base />\r\n  </inbound>\r\n  <backend>\r\n    <base />\r\n  </backend>\r\n  <outbound>\r\n    <base />\r\n  </outbound>\r\n</policies>"
          },
          "resources": [],
          "dependsOn": [
            "[resourceId('Microsoft.ApiManagement/service/products', parameters('apimServiceName'), parameters('product_unlimited_name'))]"
          ]
        }
      ],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]",
        "[resourceId('Microsoft.ApiManagement/service/groups', parameters('apimServiceName'), 'administrators')]",
        "[resourceId('Microsoft.ApiManagement/service/groups', parameters('apimServiceName'), 'developers')]",
        "[resourceId('Microsoft.ApiManagement/service/groups', parameters('apimServiceName'), 'guests')]",
        "[resourceId('Microsoft.ApiManagement/service/groups', parameters('apimServiceName'), 'office-services')]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/groups/office-services",
      "type": "Microsoft.ApiManagement/service/groups",
      "name": "[concat(parameters('apimServiceName'), '/' ,parameters('group_office-services_name'))]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "Office Services",
        "description": null,
        "builtIn": false,
        "type": "custom",
        "externalId": null
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/properties/environment",
      "type": "Microsoft.ApiManagement/service/properties",
      "name": "[concat(parameters('apimServiceName'),'/','environment')]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "environment",
        "value": "[parameters('environment_value')]",
        "tags": null,
        "secret": false
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    },
    {
      "comments": "Generated for resource /subscriptions/c107df29-a4af-4bc9-a733-f88f0eaa4296/resourceGroups/PreDemoTest/providers/Microsoft.ApiManagement/service/ibizmalo/properties/myfunctions-key",
      "type": "Microsoft.ApiManagement/service/properties",
      "name": "[concat(parameters('apimServiceName'),'/','myfunctions-key')]",
      "apiVersion": "2017-03-01",
      "properties": {
        "displayName": "myfunctions-key",
        "value": "[listsecrets(resourceId(parameters('myfunctions_resourceGroup'),'Microsoft.Web/sites/functions', parameters('myfunctions_siteName'), 'Customer'),'2015-08-01').key]",
        "tags": [
          "key",
          "function",
          "auto"
        ],
        "secret": true
      },
      "resources": [],
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service', parameters('apimServiceName'))]"
      ]
    }
  ],
  "outputs": {}
}